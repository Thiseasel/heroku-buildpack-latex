#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2

echo "Installing LaTeX (TinyTeX)..."

# Download and install TinyTeX without modifying the PATH
wget -qO- "https://yihui.org/tinytex/install-bin-unix.sh" | sh -s -- --no-path

# Move TinyTeX to the build directory to ensure it's accessible at runtime
mkdir -p $BUILD_DIR/.tinytex
cp -r $HOME/.TinyTeX $BUILD_DIR/.tinytex

echo "Configuring PATH to include TinyTeX binaries..."

# Add TinyTeX binaries to PATH
export PATH="$BUILD_DIR/.tinytex/bin/x86_64-linux:$PATH"

echo "Verifying pdflatex installation..."

# Check if pdflatex is available
if ! command -v pdflatex &> /dev/null
then
    echo "pdflatex could not be found"
    exit 1
fi

echo "Installing additional LaTeX packages..."

# Update tlmgr and install only non-core packages
tlmgr update --self --repository=https://mirror.ctan.org/systems/texlive/tlnet

tlmgr install \
  textgreek \
  setspace \
  titlesec \
  caption

echo "LaTeX installation and package setup complete."

echo "Cleaning up temporary files..."
rm -rf $HOME/.TinyTeX
rm TinyTeX.tar.gz

exit 0
